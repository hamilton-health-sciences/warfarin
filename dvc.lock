schema: '2.0'
stages:
  convert_baseline:
    cmd: python3 scripts/convert_sas_to_feather.py --input_filename data/raw_data/merged_baseline.sas7bdat
      --output_filename data/raw_data/baseline.feather
    deps:
    - path: data/raw_data/merged_baseline.sas7bdat
      md5: 0a9c83fa2592b6257ec8328834955183
      size: 93978624
    - path: scripts/convert_sas_to_feather.py
      md5: 692c25ee75e606aff15b529d8a562228
      size: 738
    outs:
    - path: data/raw_data/baseline.feather
      md5: 753fac5aaa8aa27b29643fe32b206506
      size: 31934690
  convert_inr:
    cmd: python3 scripts/convert_sas_to_feather.py --input_filename data/raw_data/merged_inr.sas7bdat
      --output_filename data/raw_data/inr.feather
    deps:
    - path: data/raw_data/merged_inr.sas7bdat
      md5: c1e39f337ef4deacc55eb55dd5e84840
      size: 1338245120
    - path: scripts/convert_sas_to_feather.py
      md5: 692c25ee75e606aff15b529d8a562228
      size: 738
    outs:
    - path: data/raw_data/inr.feather
      md5: 8c0562a1bb26f1fd910582ca7c3f2252
      size: 263391586
  convert_events:
    cmd: python3 scripts/convert_sas_to_feather.py --input_filename data/raw_data/merged_events.sas7bdat
      --output_filename data/raw_data/events.feather
    deps:
    - path: data/raw_data/merged_events.sas7bdat
      md5: 5c071f4777f39678e72fca9c16a69430
      size: 253378560
    - path: scripts/convert_sas_to_feather.py
      md5: 692c25ee75e606aff15b529d8a562228
      size: 738
    outs:
    - path: data/raw_data/events.feather
      md5: 9d4e3405130483184e4d600339851997
      size: 7940194
  preprocess:
    cmd: python3 scripts/preprocess_combine_af.py --baseline_path data/raw_data/baseline.feather
      --inr_path data/raw_data/inr.feather --events_path data/raw_data/events.feather
      --output_directory data/clean_data
    deps:
    - path: data/raw_data/baseline.feather
      md5: 753fac5aaa8aa27b29643fe32b206506
      size: 31934690
    - path: data/raw_data/events.feather
      md5: 9d4e3405130483184e4d600339851997
      size: 7940194
    - path: data/raw_data/inr.feather
      md5: 8c0562a1bb26f1fd910582ca7c3f2252
      size: 263391586
    - path: scripts/preprocess_combine_af.py
      md5: 68d2cceafd46cd788034ca6451d6d458
      size: 5322
    params:
      params.yaml:
        data.events_to_keep:
          DEATH: Death
          STROKE: Ischemic Stroke
          MAJOR_BLEED: Major Bleeding
          MINOR_BLEED: Minor Bleeding
          HEM_STROKE: Hemorrhagic Stroke
          HOSP: Hospitalization
          SYS_EMB: Systemic Embolism
        preprocess.dose_outlier_threshold: 140
        preprocess.event_range: 90
        preprocess.static_state_columns:
        - SEX
        - RACE2
        - SMOKE
        - BMED_ASPIRIN
        - BMED_AMIOD
        - DIABETES
        - HX_CHF
        - HYPERTENSION
        - HX_MI
        - BMED_THIENO
        - AGE_DEIDENTIFIED
        - WEIGHT
    outs:
    - path: data/auditing
      md5: 7a4e8e21e1dc4817f86de0b8bbd71ff1.dir
      size: 386038904
      nfiles: 16
    - path: data/clean_data/baseline.feather
      md5: 9befc0bfa703ad2065c768f78083b056
      size: 12002450
    - path: data/clean_data/events.feather
      md5: 58fe757b812ad14754e029c38f4771c5
      size: 2842122
    - path: data/clean_data/inr.feather
      md5: 093e2fc30038bdfe560471fde6b98de1
      size: 14296778
    - path: data/clean_data/merged.feather
      md5: 00ffb420d54bfe34f1a7b3f3e397ec31
      size: 12711474
    - path: data/clean_data/test_data.feather
      md5: 3f3c4650aae6a665b3cc260ca7c627d6
      size: 2552386
    - path: data/clean_data/train_data.feather
      md5: 1c37c43b9b451ca67eab9384eedefe41
      size: 9437298
    - path: data/clean_data/val_data.feather
      md5: 20da198ead04ed5d248bb5eb0b0c7126
      size: 756706
  audit_preprocess:
    cmd: python3 scripts/audit_combine_preprocessing.py > output/combine_preprocess_audit.txt
    deps:
    - path: data/auditing
      md5: 8dd99135e4707f371e7fd86f32469be2.dir
      size: 386239518
      nfiles: 18
    - path: data/clean_data/baseline.feather
      md5: 9befc0bfa703ad2065c768f78083b056
      size: 12002450
    - path: data/clean_data/events.feather
      md5: 58fe757b812ad14754e029c38f4771c5
      size: 2842122
    - path: data/clean_data/inr.feather
      md5: 093e2fc30038bdfe560471fde6b98de1
      size: 14296778
    - path: data/clean_data/merged.feather
      md5: 00ffb420d54bfe34f1a7b3f3e397ec31
      size: 12711474
    - path: data/clean_data/test_data.feather
      md5: 3f3c4650aae6a665b3cc260ca7c627d6
      size: 2552386
    - path: data/clean_data/train_data.feather
      md5: 1c37c43b9b451ca67eab9384eedefe41
      size: 9437298
    - path: data/clean_data/val_data.feather
      md5: 20da198ead04ed5d248bb5eb0b0c7126
      size: 756706
    - path: scripts/audit_combine_preprocessing.py
      md5: b0d4bc6ff636f54ed09f9b39544e7121
      size: 17748
    params:
      params.yaml:
        data.events_to_keep:
          DEATH: Death
          STROKE: Ischemic Stroke
          MAJOR_BLEED: Major Bleeding
          MINOR_BLEED: Minor Bleeding
          HEM_STROKE: Hemorrhagic Stroke
          HOSP: Hospitalization
          SYS_EMB: Systemic Embolism
        preprocess.static_state_columns:
        - SEX
        - RACE2
        - SMOKE
        - BMED_ASPIRIN
        - BMED_AMIOD
        - DIABETES
        - HX_CHF
        - HYPERTENSION
        - HX_MI
        - BMED_THIENO
        - AGE_DEIDENTIFIED
        - WEIGHT
